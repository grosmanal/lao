{% extends 'base.html.twig' %}

{% block title %}{{ content.title|trans }}{% endblock %}

{% block body %}

<div id="patient-content" class="patient-content">
    <section class="identity-section card">
        <h3 class="card-header">
            {% trans %}Patient{% endtrans %}
        </h3>
        <div class="card-body" id="info-content">
            {% include "patient/info.html.twig" %}
        </div>
    </section>

    <section class="availability-section card mt-3">
        <h3 class="card-header">
            {% trans %}Availabilities{% endtrans %}
        </h3>
        <div class="card-body" id="availability-content">
            {% include "patient/availability.html.twig" %}
        </div>
    </section>

    <section class="care-request-section card mt-3">
        <h3 class="card-header">
            {% trans %}Care requests{% endtrans %}
        </h3>
        <div class="card-body" id="care-request-content">
            <div id="care-requests-accordion" class="accordion">
            {% for careRequest in careRequests %}
                <div class="accordion-item">
                    {% set careRequestForm = careRequestForms[careRequest.id] %}
                    {% set showCareRequest = careRequest.active %}
                    {% include "patient/care_request.html.twig" %}
                </div>
            {% endfor %}
            </div>
        </div>
    </section>
</div>

{% endblock %}

{% block stylesheets %}
    {{ parent() }}

    {{ encore_entry_link_tags('patient') }}
{% endblock %}

{% block javascripts %}
    {{ parent() }}

    <script>
        const patientParams = {
            currentDoctorId: {{ app.user.id }}, // TODO comment faire si l'utilisateur n'est pas un docteur ? (voir https://manal.xyz/gitea/origami_informatique/lao/issues/35)
            urlApiPatientPut: "{{ url('api_patients_put_item', {id: patient.id }) }}",
            urlApiCareRequestPut: "{{ url('api_care_requests_put_item', {id: '%id%'})|replace({'%25': '%'}) }}",
            urlCareRequestForm: "{{ url('care_request_form', {id: '%id%'})|replace({'%25': '%'}) }}",
            urlComment: "{{ url('comment', {id: '%id%'})|replace({'%25': '%'}) }}",
            urlApiCommentPost: "{{ url('api_comments_post_collection') }}",
            urlApiCommentDelete: " {{ url('api_comments_delete_item', {id: '%id%'})|replace({'%25': '%'}) }} "
        };
    </script>
    
    {{ encore_entry_script_tags('patient') }}
{% endblock %}